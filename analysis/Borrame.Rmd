---
title: "CIS 2020 análisis"
subtitle: "Análisis de datos de todos los partidos"
author: "ImJaviPerez"
date: "Diciembre 2022"
output:
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: 4
  html_document:
    toc: yes
    toc_depth: '4'
    df_print: paged
header-includes:
- \usepackage{xcolor}
- \usepackage{framed}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[RO,RE]{AnálisiS total}
- \fancyfoot{}
- \fancyfoot[RE,LO]{Votos 2020}
- \fancyfoot[LE,RO]{\thepage}
bibliography: BibliografiaME.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message = FALSE)

#    include = FALSE prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
#    echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
#    message = FALSE prevents messages that are generated by code from appearing in the finished file.
#    warning = FALSE prevents warnings that are generated by code from appearing in the finished.
#    fig.cap = "..." adds a caption to graphical results.
#    results='asis' = output as-is, i.e., write raw results from R into the output document
```


```{r include=FALSE}
# Borrar toda las variables
### rm(list=ls())
```

***
```{r}
# List of libraries
library(foreign)
library(dplyr)
library(pander)
library(car)
library(ca)

library(gridExtra)
library(grid)
library(lattice)
library(ggplot2)
library(ggrepel)

library(factoextra)

library("RcmdrMisc")
library(cluster)
library(RANN)

library(diverse)
library(corrplot)

```

```{r}
# TODO: Mostrar u ocultar resultados de chunks de una variable
doc4JRB <- FALSE
```


https://bookdown.org/yihui/rmarkdown-cookbook/results-asis.html#results-asis

https://bookdown.org/yihui/rmarkdown-cookbook/reuse-chunks.html

https://bookdown.org/yihui/rmarkdown-cookbook/knit-expand.html

https://bookdown.org/yihui/rmarkdown-cookbook/child-document.html#child-document



\pagebreak

# Análisis de correspondencias múltiples
Datos cualitativos procedentes de encuestas realizadas por el  [Centro de Investigaciones Sociológicas (CIS)](https://www.cis.es) en septiembre de 2020:
[Encuesta 3293/0 POSTELECTORAL DEL PAÍS VASCO. ELECCIONES AUTONÓMICAS 2020](https://www.cis.es/cis/opencm/ES/1_encuestas/estudios/listaMuestras.jsp?estudio=14522).

# Descripción del fichero de datos.

Para conocer las preguntas consultar el fichero: "Estudio: Postelectoral Autonómicas País Vasco 2020 Clave: ECIS3293" del link mencionado anteriormente.


Ahora, realizamos el ACM en todas las columnas seleccionadas:


Por defecto la función `mjca` toma el método de escalado `lambda = "adjusted"`, con lo que únicamente se consideran los valores propios obtenidos en el ACM mayores que $\frac{1}{Q}=$

Por lo tanto en nuestro caso el número de dimensiones será:


## Datos objetivos y datos de opinión
Debemos tener en cuenta que hay una serie de variables que son datos objetivos de la persona como por ejemplo su provincia de empadronamiento. A estas características las llamaremos variables *ilustrativas*, que son:

El resto de preguntas pueden considerarse de opinión. El ACM trata de ubicar los datos objetivos entre las diferentes escalas de opiniones.

# Selección de dimensiones más representativas

Se realiza una primera tentativa de ACM sólo con las variables de opinión:

Inercias de los autovalores principales:


Con 

 dimensiones se explica el 

 % de la varianza.


Seleccionamos las modalidades más importantes de cada factor.


Ya se dijo que se iban a representar 

 dimensiones.
 
Se analiza el contenido de cada dimensión de una en una teniendo en cuenta el significado de cada parámetro obtenido:

 + `qlt`: representa la *calidad* de esa modalidad. Es el $cos^2$ y mide el grado de asociación de una modalidad con esa dimensión.
 + `k`: nos da las coordenadas de la modalidad en esa dimensión (en ese eje).
 + `cor`: correlaciones al cuadrado entre la modalidad y la dimensión.
 + `ctr`: para interpretar cada dimensión se analizan las contribuciones  absolutas (`ctr`). Esta columna es la que realmente representa cuánto de importante es una modalidad dentro de esa dimensión. 

Disponemos de 

 variables que abarcan 

 modalidades. Precisamente cada una de estas modalidades va a contribuir (`ctr`) a crear cada dimensión.


## Dimensión 1


En el **lado positivo del eje** las modalidades mejor representadas son:



Para explicar el significado de un eje, hay que ver la contribución (`ctr`) de cada modalidad dentro de esa parte del eje. A continuación se explican las modalidades más significativa de este lado del eje en orden de preguntas (no por su contribución):

 + `(*)RECUVOTOA:Ciudadanos`
 + `P10DIGITAL:Menciona` = Fuentes utilizadas para informarse sobre las elecciones autonómicas del País Vasco de 2020: 

: 

 + `P11_2:Menciona`, `P11_3:Menciona`
 + `P12_1:Menciona`, `P12_5:Menciona`, `P12_7:No menciona`
 + `P15:Sí`
 + `P15A_1:No menciona`, `P15A_2:No menciona`, `P15A_11:No menciona`, `P15A_12:Menciona`, `P15A_12:No menciona`, `P15A_18:No menciona`, `P15A_21:No menciona`, `P15A_95:No menciona`, `P15A_98:No menciona`, `P15A_99:No menciona`
 + `P16:Sí` =

: 

   + `P16A_1:No menciona`, `P16A_2:No menciona`, ``P16A_11:No menciona`, `P16A_12:No menciona`, `P16A_18:No menciona`, `P16A_21:No menciona`, `P16A_95:No menciona`, `P16A_98:No menciona`, `P16A_99:No menciona` = No menciona a: 

   + `P16A_11:Menciona`, `P16A_12:Menciona` = Sí menciona a: 

  + `P27:Un Estado en el que se reconociese a las comunidades autónomas la posibilidad de convertirse en Estados independientes `
 + `P3_2:Sí`
 + `P3_3:Sí`
 + `P3_4:Sí`
 + `RELIGION:Ateo/a`
 
En resumen: Este eje lado del eje representa a las personas que ....

En el **lado negativo del eje** están las "variables:modalidades":



Para explicar el significado de un eje, hay que ver la contribución (`ctr`) de cada modalidad dentro de esa parte del eje. A continuación se explican las modalidades más significativa de este lado del eje en orden de preguntas (no por su contribución):

+ `ESCIDEOL_GRUPO:N.C.`, `ESCIDEOLPAR_1_GRUPO:N.C.`, `ESCIDEOLPAR_1_GRUPO:N.S.`, `ESCIDEOLPAR_2_GRUPO:N.C.`, `ESCIDEOLPAR_2_GRUPO:N.S.`, `ESCIDEOLPAR_3_GRUPO:N.C.`, `ESCIDEOLPAR_3_GRUPO:N.S.`, `ESCIDEOLPAR_4_GRUPO:N.C.`, `ESCIDEOLPAR_4_GRUPO:N.S.`, `ESCIDEOLPAR_5_GRUPO:N.C.`, `ESCIDEOLPAR_5_GRUPO:N.S.`, `ESCIDEOLPAR_6_GRUPO:N.C.`, `ESCIDEOLPAR_6_GRUPO:N.S.`, `ESCIDEOLPAR_7_GRUPO:N.C.`, `ESCIDEOLPAR_7_GRUPO:N.S.`, `P10_2:N.C.`, `P12_7:Menciona`, `P24_1:N.C.`, `P24_2:N.C.`, `P24_3:N.C.`, `P24_4:N.C.`, `P24_5_GRUPO:N.C.`, `P24_6_GRUPO:N.C.`, `P24_7_GRUPO:N.C.`, `P26_1:N.C.`, `P26_2:N.C.`, `P26_3_GRUPO:N.C.`, `P26_4_GRUPO:N.C.`, `P26_5_GRUPO:N.C.`, `P26_6_GRUPO:N.C.`, `P29:N.C.`, `P3_1:No`, `P3_3:No`, `P5A_GRUPO:N.C.`, `P6:Nada`


Este lado del eje representa a las personas que ...


**JRB**

En resumen: Este eje representa a las personas que por un extremo ...





# Individuos


A continuación se muestran a los individuos en diferentes planos factoriales.


## Individuos de *EQUO Berdeak*

Se toma a todos los que han votado a *EQUO Berdeak* en 2020. Es de esperar que haya opiniones variadas dentro de este conjunto, Por ello se buscan grupos homogeneos con opiniones coincidentes. A cada uno de esostos subgrupos *coincidentes* les llamaremos *clusters*.



Se muestran a todos los vecinos de *EQUO Berdeak* en diferentes planos factoriales.



## Outliers *EQUO Berdeak*

Se buscan individuos que se alejan *demasiado* de la media que se podrían interpretar como personas que realmente votan a *EQUO Berdeak* pero que están alejados de sus posturas, o bien como encuestas erroneas, o en el peor de los casos individuos que no han dicho la verdad al ser encuestados.



Distancias de los outliers que están más allá del 95% de la media del grupo:



Outliers. Número de encuesta:





## Clusters de los votantes de *EQUO Berdeak*

### Clusters y outliers


se puede buscar el número óptimo de clusters (`k`) usando la función `daisy` (Dissimilarity Matrix Calculation) que computa las desigualdades en las distancias entre parejas. En este caso para obtener el número óptimo de clusters y su composición se ha usado la métrica euclídea al cuadrado para computar las distancias.



El cluster número 

 tiene 

 elemento que corresponde con la encuesta número:

 
. Parace que siempre está aislado del resto. Existe la posibilidad de que este individuo no haya dicho la verdad en su encuesta. Lo eliminamos y repetimos el análisis cluster.



### Clusters, segundo intento



se puede buscar el número óptimo de clusters (`k`) usando la función `daisy` (Dissimilarity Matrix Calculation) que computa las desigualdades en las distancias entre parejas. En este caso para obtener el número óptimo de clusters y su composición se ha usado la métrica euclídea al cuadrado para computar las distancias.



### Caracteristicas de cada cluster de *EQUO Berdeak*

Variabilidad de variables categóricas

https://en.wikipedia.org/wiki/Categorical_distribution

https://stats.stackexchange.com/questions/221332/variance-of-a-distribution-of-multi-level-categorical-data

https://www.cienciasinseso.com/medidas-de-dispersion-cualitativas/

https://cran.r-project.org/web/packages/diverse/diverse.pdf

https://cran.r-project.org/web/packages/qualvar/vignettes/wilcox1973.html


Queremos saber qué tienen en común los individuos de cada cluster. Para ello se analizan y se buscan  las respuestas que más se repiten dentro de cada cluster. dicho en términos matemáticos: se buscan las respuestas con menor entropía.


Hay diferentes formas de medir la diversidad o entropía (https://diposit.ub.edu/dspace/bitstream/2445/45784/1/623311.pdf), pero existe correlación entre todas ellas (https://cran.r-project.org/web/packages/diverse/diverse.pdf): Con estas se cuantifican la *separación*, *variedad* y *disparidad*:

Vamos a utilizar dos índices que son parecidos entre sí. hay que normalizarlos para que no dependan del número de categorías ni del número de individuos de cada cluster. Para ello hay que dividir entre el máximo valor de cada variable. Sabiendo que $k$ es el número de categorías de una variable y que $n$ es el número de individuos de un cluster:
  
  - Índice de Gini-Simpson (también llamado índice de Blau).
  $$B_{max}=\frac{k-1}{k}$$
  - Entropía o índice de Techman
  $$H_{max}=\ln{k}$$





ESTAS AQUI   ESTAS AQUI   ESTAS AQUI   ESTAS AQUI   

Atributos más importantes de este cluster


## k-vecinos de *EQUO Berdeak*

RANN: Fast Nearest Neighbour Search (Wraps ANN Library) Using L2 Metric


Se muestran a todos los vecinos de *EQUO Berdeak* en diferentes planos factoriales.



## Decidir el número de cluster y caracterizar estos cluster.

Se toman a todas las personas que dicen haber votado a "EQUO Berdeak" y a todos sus vecinos más cercanos. 


Se muestra la división cluster por el método *Ward.D* o también conocido como *"pérdida de inercia mínima"*.



se puede buscar el número óptimo de clusters (`k`) usando la función `daisy` (Dissimilarity Matrix Calculation) que computa las desigualdades en las distancias entre parejas. En este caso para obtener el número óptimo de clusters y su composición se ha usado la métrica euclídea al cuadrado para computar las distancias.



Queremos saber qué tienen en común los individuos de cada cluster. Para ello se analizan y se buscan  las respuestas que más se repiten dentro de cada cluster. dicho en términos matemáticos: se buscan las respuestas con menor entropía.



Se muestra la correlación entre ambos índices:





# Apendices

## Elegir índice de diversidad:

https://diposit.ub.edu/dspace/bitstream/2445/45784/1/623311.pdf

**Variety Indexes**

Diversity as variety conceptualizes categorical differences across the relevant characteristics between group members.
 
 - Blau’s values are not validly comparable if the number of categories is not identical across diversity variables. Nevertheless, researchers have asserted that comparisons between variables with a dissimilar number of categories still make sense, as long as larger number of categories contributes to greater diversity
 $$B_{max} = \frac{k-1}{k}$$
 
 - IQV However, the index B can be normalized by dividing it by its maximum. This controls for the number of categories, and gives the Index of Qualitative Variation (IQV; Agresti & Agresti, 1978). Blau’s index and IQV can be used interchangeably when comparing variables with the same number of categories because they are highly similar measures and only differ in scale. if Blau’s index and IQV are multiplied by $n/(n-1)$, the estimators obtained are unbiased.

**Disparity Indexes**

Diversity as disparity assumes asymmetry and is defined as the difference between group members in terms of the resources each of them
holds. It reflects both the distances between group members and the dominance of those individuals that have higher amounts of the attribute.

 - The coefficient of variation, V, is calculated by dividing the standard deviation by the mean.
 - Gini coefficient, $\Delta$, is a measure of inequality for quantitative variables and it is defined as the average of the absolute differences of all pairs of variate values in a sample, expressed in terms of units of the variate. The coefficient is not suitable for ratio scales, but can be obtained in interval scales.
 - The Gini coefficient of concentration is defined $G$ so $\Delta$ is converted into a scale invariant measure by dividing the coefficient of concentration by twice the arithmetic mean. he coefficient G is only appropriate for attributes measured by ratio scales (Allison, 1978). G has lower and upper bounds, although its maximum value depends on $n$.
 
**Separation Indexes**

Diversity as separation conceptualizes the member’s differences in position or disagreement in opinion toward a global attribute.

 - The widely used measures of diversity as separation are standard deviation (SD) and mean Euclidean distance (D).


## Atributos de cada variable




***

\pagebreak


---
