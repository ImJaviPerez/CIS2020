---
title: "CIS 2020 cocina"
subtitle: "Todas las encuestas"
author: "ImJaviPerez"
date: "Diciembre 2022"
output:
  html_document:
    toc: yes
    toc_depth: '4'
    df_print: paged
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: 4
header-includes:
- \usepackage{xcolor}
- \usepackage{framed}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[RO,RE]{Cocinado total}
- \fancyfoot{}
- \fancyfoot[RE,LO]{Votos 2020}
- \fancyfoot[LE,RO]{\thepage}
bibliography: BibliografiaME.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE)

#    include = FALSE prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
#    echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
#    message = FALSE prevents messages that are generated by code from appearing in the finished file.
#    warning = FALSE prevents warnings that are generated by code from appearing in the finished.
#    fig.cap = "..." adds a caption to graphical results.
#    results='asis' = output as-is, i.e., write raw results from R into the output document
```


```{r include=FALSE}
# Borrar toda las variables
### rm(list=ls())
```

***
```{r}
library(usethis)
use_git_config(user.name = "ImJaviPerez", user.email = "ImJaviPerez@gmail.com")
# usethis::edit_git_config()
```


```{r}
# List of libraries
library(foreign)
library(dplyr)
library(pander)
library(car)
library(ca)
```

```{r}
library(log4r)
# Create a new logger object with create.logger().
logger <- create.logger()
# Set the logger's file output.
logfile(logger) <- 'cis_2020_cuisine.log'
# Set the current level of the logger.
level(logger) <- "DEBUG"
#level(logger) <- "INFO"
# At priority level INFO, a call to debug() won't print anything.
# debug(logger, 'A Debugging Message')
info(logger, 'Starting script')
# warn(logger, 'A Warning Message')
# error(logger, 'An Error Message')
# fatal(logger, 'A Fatal Error Message')

```


```{r}
# TODO
# http://destio.us.es/calvo/asignaturas/ge_esco/tutorialusargitgithubrstudio/UsarGitGithubconRStudio.html
# Seguir indicaciones de JRB
```


\pagebreak

# Análisis de correspondencias múltiples
Datos cualitativos procedentes de encuestas realizadas por el  [Centro de Investigaciones Sociológicas (CIS)](https://www.cis.es) en septiembre de 2020:
[Encuesta 3293/0 POSTELECTORAL DEL PAÍS VASCO. ELECCIONES AUTONÓMICAS 2020](https://www.cis.es/cis/opencm/ES/1_encuestas/estudios/listaMuestras.jsp?estudio=14522).

# Descripción del fichero de datos.

Para conocer las preguntas consultar el fichero: "Estudio: Postelectoral Autonómicas País Vasco 2020 Clave: ECIS3293" del link mencionado anteriormente.

## Descripción de los datos.
Se pueden descargar todos los datos de la página del CIS. Allí se encuentran tres ficheros:

  + "3293.sav", fichero de datos en formato SPSS.
  + "DA3293", que contiene todas las encuestas realizadas codificadas en un fichero de texto.
  + "ES3293", que contiene la explicación de todos los código utilizados en las encuestas.

```{r}
require(foreign)
DATA_FILE_SPSS <- "../data/MD3293/3293.sav"
cis_2020_df <- foreign::read.spss(DATA_FILE_SPSS, to.data.frame = TRUE)
```
El fichero contiene $n=$
```{r echo=FALSE, results='asis'}
cat(nrow(cis_2020_df))
```
 encuestas y $Q=$
```{r echo=FALSE, results='asis'}
cat(ncol(cis_2020_df))
```
 preguntas por encuesta. Cada pregunta $q$ consta de un número variable de *modalidades* de respuesta. Por ejemplo la pregunta `P4` tiene 
```{r echo=FALSE, results='asis'}
cat(nlevels(cis_2020_df$P4))
```
 modalidades que son:
 
```{r echo=FALSE, results='asis'}
cat(paste0("`", levels(cis_2020_df$P4), "`", collapse = ", "))
```

y la pregunta `P5` tiene 
```{r echo=FALSE, results='asis'}
cat(nlevels(cis_2020_df$P5))
```
 modalidades:

```{r echo=FALSE, results='asis'}
cat(paste0("`", levels(cis_2020_df$P5), "`", collapse = ", "), ".", sep = "")
```

### Datos numéricos y datos cualitativos
```{r}
# Indices of numeric variables
numeric_cols_idx <- which(sapply(cis_2020_df, is.numeric))
# Names of numeric variables
numeric_cols_names <- colnames(cis_2020_df[,numeric_cols_idx])
n_numeric <- length(numeric_cols_idx)

# Indices of factor variables
factor_cols_idx <- which(sapply(cis_2020_df, is.factor))
n_factor <- length(factor_cols_idx)

n_other <- length(cis_2020_df) - n_numeric - n_factor
```


```{r eval=FALSE, include=FALSE}
n_numeric <- 0
n_factor <- 0
n_other <- 0
numeric_cols_idx <- c()
for (i in 1:ncol(cis_2020_df)) {
  if (class(cis_2020_df[,i]) == "numeric"){
    n_numeric <- n_numeric + 1
    numeric_cols_idx <- c(numeric_cols_idx, i)
  }else if (class(cis_2020_df[,i]) == "factor"){
    n_factor <- n_factor + 1
  }else{
    n_other <- n_other + 1
  }
}
# numeric_cols_idx
numeric_cols_names <- colnames(cis_2020_df[,numeric_cols_idx])
```

Tenemos
```{r echo=FALSE, results='asis'}
cat(n_numeric)
```
 preguntas de carácter cuantitativo, que son:
```{r echo=FALSE, results='asis'}
cat(paste0("`", numeric_cols_names, "`", collapse = ", "), ".", sep = "")
```
El resto de las preguntas son de carácter cualitativo.

En este estudio se evitan inicialmente los datos numéricos.

```{r echo=FALSE, results='asis'}
excluded_cols <- numeric_cols_names
cat(paste0("`", excluded_cols, sep="`", collapse = ", "), ".")
```

Así mismo, también se excluyen las variables que no cambian de valor a lo largo de todas las encuestas.
```{r always_same_response}
# From :https://github.com/tidyverse/dplyr/blob/master/vignettes/programming.Rmd
# If you have a character vector of variable names, and want to operate on them with a for loop, index into the special .data pronoun:
#
aux_idx <- c()
for (i in colnames(cis_2020_df)[!(colnames(cis_2020_df) %in% excluded_cols)] ) {
  # En esta variable todas las encuestas tienen el mismo resultado => se excluye es variable
  aux_tbl <- cis_2020_df %>% dplyr::count(.data[[i]], .drop = FALSE)
  if (max(aux_tbl$n) == nrow(cis_2020_df)) aux_idx <- c(aux_idx, i)
}
excluded_cols <- c(excluded_cols, aux_idx)
```
Que son: 
```{r echo=FALSE, results='asis'}
cat(paste0("`", aux_idx, "`", collapse = ", "), sep = "", ".")
```

Además también se excluyen las variables, como el "número de cuestionario", que tienen un valor único para cada encuesta.
```{r always_diferent_response}
# From :https://github.com/tidyverse/dplyr/blob/master/vignettes/programming.Rmd
# If you have a character vector of variable names, and want to operate on them with a for loop, index into the special .data pronoun:
#
aux_idx <- c()
for (i in colnames(cis_2020_df)[!(colnames(cis_2020_df) %in% excluded_cols)] ) {
  # En esta variable todas las encuestas tienen un resultado diferente => se excluye es variable
  aux_tbl <- cis_2020_df %>% dplyr::count(.data[[i]], .drop = FALSE)
  if (nrow(aux_tbl) == nrow(cis_2020_df)) aux_idx <- c(aux_idx, i)
}
excluded_cols <- c(excluded_cols, aux_idx)
```

```{r echo=FALSE, results='asis'}
if ( !is.null(aux_idx)){
  cat("Variables excluidas: ", paste0("`", aux_idx, "`", collapse = ", "), sep = "", ".")
}
```

Con lo que las columnas excluidas son:
```{r echo=FALSE, results='asis'}
cat(paste0("`", excluded_cols, "`", collapse = ", "), sep = "", ".")
```
 

O sea que inicialmente se han descartado 
```{r echo=FALSE, results='asis'}
cat(length(excluded_cols))
```
preguntas de un total de 
```{r echo=FALSE, results='asis'}
cat(length(cis_2020_df))
```
.


### Datos erroneos.
Suponemos que no hay datos erróneos dado que la fuente es el propio CIS.

# Análisis de correspondencias múltiples (ACM)
La parte de la inercia total explicada por la cuestión $q$ es:
$$C(q) = \frac{1}{Q} (J_q -1)$$
donde $J_q$ es el número de modalidades de la cuestión $q$. Por tanto a más modalidades dentro de una cuestión, más inercia explicada.

La parte de la inercia total explicada por la modalidad $j$ es:
$$c(j) = \frac{1}{Q} \left(  1 - \frac{d_{jj}}{n} \right)$$
donde $d_{jj}$ es el efectivo de una modalidad $j$, o sea el  número de veces que aparece esa modalidad entre todas las encuestas. No es conveniente que haya modalidades con un efectivo $d_{jj}$ pequeño, y es importante que los efectivos de las diferentes modalidades estén equilibrados.

## Efectivo *pequeño*

Antes de aplicar el ACM, realizamos un análisis descriptivo, para detectar la existencia de modalidades con pequeño efectivo.

El criterio para definir “*efectivo pequeño*” es que el número  de efectivos de una modalidad sea menor que: 
```{r echo=FALSE, results='asis'}
efectivo_min_percent <- 0.02
efectivo_min_abs <- round(efectivo_min_percent * nrow(cis_2020_df))

cat(efectivo_min_percent, "$\\cdot$", "n =", efectivo_min_percent, "$\\cdot$", nrow(cis_2020_df), "=", efectivo_min_abs)
```

```{r efect_peq_dplyr}
# Create data frame 
efectivo_peq_df <- data.frame(matrix(ncol = 3, nrow = 0))
colnames(efectivo_peq_df) <- c("variable", "modalidad", "freq")

require(dplyr)

for (i in colnames(cis_2020_df)[!(colnames(cis_2020_df) %in% excluded_cols)]) {
  aux_tbl <- cis_2020_df %>% dplyr::count(.data[[i]], .drop = FALSE)
  aux_idx <- which(aux_tbl$n < efectivo_min_abs)
  
  for (j in aux_idx) {
    efectivo_peq_df[nrow(efectivo_peq_df)+1,] <- c(i, aux_tbl[j,1], aux_tbl[j,2])
  }
}
```

Hay 
```{r echo=FALSE, results='asis'}
cat(length(unique(efectivo_peq_df$variable)))
```
 variables con efectivo pequeño son:
 
```{r echo=FALSE, results='asis'}
cat(paste0("`", unique(efectivo_peq_df$variable), "`", collapse = ", "), sep = "", ".")
```

Es necesario *"cocinar"* estas variables una a una.

```{r echo=FALSE, results='asis'}
# cat(sprintf("### Variable `%s`: *%s*\n", 
#        unique(efectivo_peq_df$variable),
#        attributes(cis_2020_df)$variable.labels[unique(efectivo_peq_df$variable)]),
#    sep = "")
```

### Variable `TAMUNI`: *Tamaño de municipio*

```{r}
require(dplyr)
require(pander)
pander(cis_2020_df %>% dplyr::count(TAMUNI, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'TAMUNI'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$TAMUNI)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

No existen personas encuestadas con municipios de más de $400000$ habitantes. Sencillamente se eliminan esas modalidades porque no tienen sentido.

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$TAMUNI)[aux_idx], collapse = "', '"), "') = NA")
cis_2020_df$TAMUNI_GRUPO <- car::recode(var = cis_2020_df$TAMUNI,
                                        recodes = recodes_str,
                                        levels = c(levels(cis_2020_df$TAMUNI)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(TAMUNI_GRUPO), .drop=FALSE)
```
Se excluye la variable `TAMUNI` y se deja la nueva agrupación `TAMUNI_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "TAMUNI")
```


### Variable `EDAD`: *Edad de la persona entrevistada*
En un primer vistazo se aprecia que prácticamente ninguna modalidad de la variable `EDAD` llega a tener el efectivo mínimo requerido: 
```{r echo=FALSE, results='asis'}
cat("(", efectivo_min_abs, ").", sep = "")
```


```{r}
require(pander)
pander(head(cis_2020_df %>% dplyr::count(EDAD)))
```

```{r}
edad_interval_len <- 4
```


Se agrupan las edades de los participantes por intervalos de 
```{r echo=FALSE, results='asis'}
cat(edad_interval_len)
```
 años:
```{r}
# copy variable in new column
cis_2020_df$EDAD_GRUPO <- cis_2020_df$EDAD
# Group data

require(car)
# Create recodes string not including last level = "N.C."
age_ini_idx <- seq(from=1, to=length(levels(cis_2020_df$EDAD))-1, by=edad_interval_len)
age_end_idx <- seq(from=edad_interval_len, to=length(levels(cis_2020_df$EDAD))-1, by=edad_interval_len)
# include higher ages at the end
if (length(age_ini_idx) > length(age_end_idx)) {
  age_end_idx <- c(age_end_idx, length(levels(cis_2020_df$EDAD))-1)
}
str_aux_1 <- levels(cis_2020_df$EDAD)[age_ini_idx]
str_aux_2 <- levels(cis_2020_df$EDAD)[age_end_idx]
# Create recodes parameter
recodes_str <- paste0(str_aux_1, ":", str_aux_2, "='", str_aux_1, "-", str_aux_2, "';", collapse = "")
# Recode EDAD in groups of length equal to edad_interval_len
cis_2020_df$EDAD_GRUPO <- car::recode(var = cis_2020_df$EDAD, recodes = recodes_str)
# Check results
require(pander)
pander(cis_2020_df %>% dplyr::count(EDAD_GRUPO, .drop=FALSE))
```
Se observa que las últimas modalidades no llegan al efectivo mínimo requerido, con lo que se reagrupan en una sola:
```{r}
# Re-recode from 86 until the end
cis_2020_df$EDAD_GRUPO <- car::recode(var = cis_2020_df$EDAD_GRUPO, recodes = "'86-89':'94-98' = '86-98'")

# Check results
require(pander)
pander(cis_2020_df %>% dplyr::count(EDAD_GRUPO, .drop=FALSE))
```

Se excluye la variable `EDAD` y se deja la nueva agrupación `EDAD_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "EDAD")
```


### Variable `A0a`: *Nacionalidad de la persona entrevistada*.
Las posibles respuestas (modalidades) a la pregunta son:

  + Sólo la nacionalidad española = 1
  + La nacionalidad española y otra = 2

Sólo hay
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'A0a'),"modalidad"])
cat(efectivo_peq_df[which(efectivo_peq_df$variable == "A0a" & efectivo_peq_df$modalidad == aux_idx ), "freq"])
```
 respuestas para la modalidad 
```{r echo=FALSE, results='asis'}
# Write factors
cat(paste0("`", levels(cis_2020_df$A0a)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
. No se puede re-codificar para agrupar con la otra modalidad.

### Variable `P1`: *Lugar de nacimiento*

```{r}
require(dplyr)
pander(cis_2020_df %>% dplyr::count(P1, .drop=FALSE))
```


Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupa junto con la modalidad 
```{r echo=FALSE, results='asis'}
cat("`", levels(cis_2020_df$P1)[3], "`", sep = "")
```
 en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P1)[c(aux_idx, 3)], collapse = "', '"), "') = levels(cis_2020_df$P1)[3]")
cis_2020_df$P1_GRUPO <- car::recode(var = cis_2020_df$P1, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P1)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P1_GRUPO), .drop=FALSE)
```
Se excluye la variable `P1` y se deja la nueva agrupación `P1_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P1")
```


#### Variable `P1A`: *Lugar de nacimiento (comunidad autónoma)*
La mayoría de los encuestados han nacido en Euskadi. La siguiente tabla muestra en qué comunidades autónomas han nacido el resto.

```{r}
require(dplyr)
pander(cis_2020_df %>% dplyr::count(P1A, .drop=FALSE))
```

Table: Comunidades autónomas de nacimiento de los encuestados (`NA` corresponde a `País Vasco`).

Dado que la mayoría no llega al efectivo mínimo requerido, se sigue el siguiente criterio:

+ Opción 1: haría Cataluña / Resto del Mediterráneo /  Andalucía+Extremadura / Galicia /  Castillas+Rioja+Madrid / Aragón+Navarra / Cantabria+Asturias
+ Opción 2: el Mediterráneo todo junto y Galicia en la Cornisa Cantábrica. Si la Cornisa Cantábrica no llega, lo juntas con Castilla. Si hay Baleares y Canarias, con el Mediterráneo. Y si aún así, el Mediterráneo no llega a 60, con Aragón y Navarra.

Se hacen las siguientes agrupaciones:

+ `Cat_Val_Isl` = Cataluña + Comunitat Valenciana + Balears (Illes) + Canarias
+ `Gal_Ast_Can` = Galicia + Asturias (Principado de) + Cantabria.
+ `Nav_Arag` = Aragón + Navarra (Comunidad Foral de).
+ `Mad_Man_Rio` = Madrid (Comunidad de) + Castilla-La Mancha + Rioja (La).
+ `And_Mur_Ceu` = Andalucía + Murcia (Región de) + Ceuta (Ciudad Autónoma de) + Melilla (Ciudad Autónoma de).

No hay nadie de *Melilla (Ciudad Autónoma de)* en esta encuesta.
```{r}
# levels(cis_2020_df$P1A)
cis_2020_df$P1A_GRUPO <- car::recode(var = cis_2020_df$P1A, recodes = "c('Cataluña', 'Comunitat Valenciana', 'Canarias', 'Balears (Illes)') = 'Cat_Val_Isl'; c('Galicia', 'Asturias (Principado de)', 'Cantabria') = 'Gal_Ast_Can'; c('Aragón', 'Navarra (Comunidad Foral de)') = 'Nav_Arag'; c('Madrid (Comunidad de)', 'Castilla-La Mancha', 'Rioja (La)') = 'Mad_Man_Rio'; c('Andalucía',  'Murcia (Región de)', 'Ceuta (Ciudad Autónoma de)', 'Melilla (Ciudad Autónoma de)') = 'And_Mur_Ceu'")
```

```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P1A_GRUPO, .drop=FALSE))
```

Table: Votantes de diferentes comunidades agrupados. La agrupación es subjetiva: las comunidades de cada grupo deben ser *similares* entre sí y además deberían contener al menos 
```{r echo=FALSE, results='asis'}
cat(efectivo_min_abs)
```
 elementos.

Se excluye la variable `P1A` y se deja la nueva agrupación `P1A_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P1A")
```

#### Variable `P1B`: *Lugar de nacimiento (país)*

Disponemos de 
```{r echo=FALSE, results='asis'}
cat(length(cis_2020_df$P1B[!is.na(cis_2020_df$P1B)]))
```
 encuestas con votantes nacidos en otros países.

Se eliminan las modalidades nulas.
```{r}
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P1B' & efectivo_peq_df$freq == 0), "modalidad"])

# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P1B)[aux_idx], collapse = "', '"), "') = NA")
cis_2020_df$P1B_GRUPO <- car::recode(var = cis_2020_df$P1B, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P1B)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P1B_GRUPO), .drop=FALSE)
```


Se recodifican en dos grupos: `Europa` y `No Europa`:


```{r}
# cat(paste0("'", levels(cis_2020_df$P1B_GRUPO), "'", collapse = ", "), sep = "")

# Create recodes parameter
recodes_str <- "c('Francia', 'Países Bajos', 'Portugal', 'Andorra', 'Alemania', 'Suiza', 'Eslovenia', 'Rusia', 'Otros territorios de Europa') = 'Europa';
c('Angola', 'Argelia', 'Guinea Bissau', 'Marruecos', 'Nigeria', 'Estados Unidos de América', 'México', 'Cuba', 'El Salvador', 'Nicaragua', 'República Dominicana', 'Argentina', 'Bolivia', 'Brasil', 'Colombia', 'Chile', 'Ecuador', 'Paraguay', 'Uruguay', 'Venezuela', 'Otros territorios de América', 'N.S./N.C.') = 'No Europa'"

# Recode
cis_2020_df$P1B_GRUPO <- car::recode(var = cis_2020_df$P1B_GRUPO, 
                                    recodes = recodes_str,
                                    levels = c('Europa', 'No Europa'))
pander(cis_2020_df %>% dplyr::count(P1B_GRUPO, .drop=FALSE))
```

Se excluye la variable `P1B` y se deja la nueva agrupación `P1B_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P1B")
```

**En este caso no tengo criterio para hacer otras reagrupaciones diferentes. Quedo pendiente de la respuesta que me de JRB.**


### Variable `P2`: *Lengua materna de la persona entrevistada*

```{r}
require(dplyr)
pander(cis_2020_df %>% dplyr::count(P2, .drop=FALSE))
```
Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se eliminan las dos modalidades nulas.
```{r}
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P2' & efectivo_peq_df$freq == 0), "modalidad"])

# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P2)[aux_idx], collapse = "', '"), "') = NA")
cis_2020_df$P2_GRUPO <- car::recode(var = cis_2020_df$P2, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P2)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P2_GRUPO), .drop=FALSE)
```

No se reagrupa más.

Se excluye la variable `P2` y se deja la nueva agrupación `P2_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P2")
```

### Variables `P3_1`, `P3_2`, `P3_3` y `P3_4`: *Nivel de conocimiento personal de la lengua vasca*

En estas preguntas se ha elegido la modalidad 
```{r echo=FALSE, results='asis'}
cat("`", levels(cis_2020_df$P3_1)[3], "`", sep = "")
```
en un máximo de
```{r echo=FALSE, results='asis'}
cat(max(efectivo_peq_df[efectivo_peq_df$variable %in% c('P3_1', 'P3_2', 'P3_3', 'P3_4'), "freq"]))
```
 ocasiones, con lo que no se reagrupan.
 
### Variable `P4`: *Valoración de la situación general de la comunidad autónoma*

```{r}
pander(cis_2020_df %>% dplyr::count(P4, .drop=FALSE))
# pander(table(cis_2020_df$P4))
# pander(as.data.frame(table(cis_2020_df$P4), col.names = c('P4', 'freq')))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P4'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P4)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P4)[aux_idx], collapse = "', '"), "') = 'NS_NC'")
cis_2020_df$P4_GRUPO <- car::recode(var = cis_2020_df$P4, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P4)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P4_GRUPO), .drop=FALSE)
```
Se excluye la variable `P4` y se deja la nueva agrupación `P4_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P4")
```

### Variable `P5A`: *Autodefinición de su ideología política (2ª opción)*
```{r}
pander(cis_2020_df %>% dplyr::count(P5A, .drop=FALSE))
```

Se hacen varias reagrupaciones[^P5AJRB],

[^P5AJRB]: Se siguen los criterios de JRB para la pregunta `P5A`.

```{r}
# levels(cis_2020_df$P5A)
# Create recodes parameter
recodes_str <- "c('Conservador/a', 'Demócrata cristiano/a', 'Liberal') = 'Centro derecha'; c('Progresista', 'Socialdemócrata') = 'Socialdemocracia'; c('Socialista', 'Comunista', 'Otras respuestas ') = 'Izquierda';  c('(NO LEER) Apolítico/a ', 'N.S.') = 'No alineado/a'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P5A) %in% c('PP', 'Ciudadanos'))
# Recode
cis_2020_df$P5A_GRUPO <- car::recode(var = cis_2020_df$P5A, 
                                    recodes = recodes_str,
                                    levels = c('Centro derecha', 'Socialdemocracia', 'Izquierda', 'Nacionalista', 'Feminista', 'Ecologista', 'No alineado/a', 'N.C.'))
pander(cis_2020_df %>% dplyr::count(P5A_GRUPO, .drop=FALSE))
```

Se excluye la variable `P5A` y se deja la nueva agrupación `P5A_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P5A")
```


### Variable `P6`: *Grado de interés por la política*

```{r}
pander(cis_2020_df %>% dplyr::count(P6, .drop=FALSE))
```
En este caso no se reagrupan modalidad.

### Variable `P7`: *Grado de interés por la campaña electoral*

```{r}
pander(cis_2020_df %>% dplyr::count(P7, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P7'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P7)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P7)[aux_idx], collapse = "', '"), "') = 'NS_NC'")
cis_2020_df$P7_GRUPO <- car::recode(var = cis_2020_df$P7, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P7)[1:4], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P7_GRUPO, .drop=FALSE))
```
Se excluye la variable `P7` y se deja la nueva agrupación `P7_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P7")
```

### Variables `P8_1`, `P8_2`, `P8_3`, `P8_4`: *Grado de utilidad de la campaña electoral*

Estas preguntas tienen efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P8_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P8_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa ninguna de ellas.

### Variable `P9`: *Tema más más debatido en la campaña electoral*

```{r}
pander(cis_2020_df %>% dplyr::count(P9, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P9'),"modalidad"])
# length(aux_idx)
# length(levels(cis_2020_df$P9))
# Write factors
cat(paste0("`", levels(cis_2020_df$P9)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
En primer lugar se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P9' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$P9)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$P9)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$P9_GRUPO <- car::recode(var = cis_2020_df$P9, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P9)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P9_GRUPO, .drop=FALSE))
```

Se hacen varias reagrupaciones[^P9JRB],

[^P9JRB]: Se siguen los criterios de JRB para la pregunta `P9`.

```{r}
# cat(levels(cis_2020_df$P9), sep = "',\n'")

# Create recodes parameter
recodes_str <- "c('El coronavirus y la gestión de la pandemia') = 'La pandemia'; 
c('El paro', 'La economía', 'La creación de empleo', 'La crisis económica', 'Los impuestos, la política fiscal', 'Las pensiones', 'La vivienda') = 'Política económica';
c('La sanidad', 'La educación', 'Las políticas sociales, los temas sociales, los derechos sociales', 'La violencia contra la mujer') = 'Políticas asistenciales';
c('El estado de las autonomías/La cuestión territorial', 'La independencia/autodeterminación') = 'Política territorial';
c('Las críticas entre partidos y/o candidatos/as', 'Los/as políticos/as/La política', 'Los errores de los partidos y los/as políticos/as', 'Las disputas entre los partidos', 'Las acusaciones personales', 'Las promesas, propuestas electorales') = 'Descrédito de la política';
c('El bipartidismo', 'El poder, la competición por el poder, la búsqueda del poder', 'La corrupción', 'El vertedero de Zaldívar', 'El medio ambiente', 'Las infraestructuras', 'Otra cuestión') = 'Impugnación del modelo';
c('Cataluña', 'Los nacionalismos', 'La inseguridad ciudadana', 'La inmigración', 'La repetición de elecciones', 'La situación del país', 'El cambio', 'Los pactos, las coaliciones', 'Todos los temas') = 'Políticas del miedo al cambio';
c('N.C.', 'Ningún tema') = 'Sin temas prioritarios'"

# Recode
cis_2020_df$P9_GRUPO <- car::recode(var = cis_2020_df$P9, 
                                    recodes = recodes_str)
pander(cis_2020_df %>% dplyr::count(P9_GRUPO, .drop=FALSE))
```


Se excluye la variable `P9` y se deja la nueva agrupación `P9_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P9")
```


#### Variable `P9A`: *Partido político más cercano a la posición personal respecto al tema debatido*

```{r}
pander(cis_2020_df %>% dplyr::count(P9A, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P9A'),"modalidad"])
# length(aux_idx)
# length(levels(cis_2020_df$P9A))
# Write factors
cat(paste0("`", levels(cis_2020_df$P9A)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se hacen varias reagrupaciones[^P9AJRB],

[^P9AJRB]: Se siguen los criterios de JRB para la pregunta `P9A`.
```{r}
# Create recodes parameter
recodes_str <- "c('PP', 'Ciudadanos', 'VOX') = 'Conservador'; c('Elkarrekin Podemos', 'Otro') = 'Elkarrekin Berdeak'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P9A) %in% c('PP', 'Ciudadanos', 'VOX', 'Elkarrekin Podemos', 'Otro'))
# Recode
cis_2020_df$P9A_GRUPO <- car::recode(var = cis_2020_df$P9A, 
                                    recodes = recodes_str,
                                    levels = c('Conservador', levels(cis_2020_df$P9A)[-aux_idx], 'Elkarrekin Berdeak'))
pander(cis_2020_df %>% dplyr::count(P9A_GRUPO, .drop=FALSE))
```

Se excluye la variable `P9A` y se deja la nueva agrupación `P9A_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P9A")
```


#### Variable `P9B`: *Grado de importancia del tema más debatido*
```{r}
pander(cis_2020_df %>% dplyr::count(P9B, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P9B'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P9B)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan las modalidades `N.S.` y `N.C.` en una sola.
```{r}
# Create recodes parameter
recodes_str <- "c('N.S.', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P9B) %in% c('N.S.', 'N.C.'))
# Recode
cis_2020_df$P9B_GRUPO <- car::recode(var = cis_2020_df$P9B, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P9B)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P9B_GRUPO, .drop=FALSE))
```

Se excluye la variable `P9B` y se deja la nueva agrupación `P9B_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P9B")
```


### Variable `P10`: *Fuentes utilizadas para informarse sobre las elecciones*

#### Variable `P10_1`: *Primer lugar (Fuentes utilizadas para informarse sobre las elecciones)*
```{r}
pander(cis_2020_df %>% dplyr::count(P10_1, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P10_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan las modalidades `N.S.` y `N.C.` en una sola.
```{r}
# Create recodes parameter
recodes_str <- "c('N.S.', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P10_1) %in% c('N.S.', 'N.C.'))
# Recode
cis_2020_df$P10_1_GRUPO <- car::recode(var = cis_2020_df$P10_1, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P10_1)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P10_1_GRUPO, .drop=FALSE))
```

Se excluye la variable `P10_1` y se deja la nueva agrupación `P10_1_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P10_1")
```

#### Variable `P10_2`: *Segundo lugar (Fuentes utilizadas para informarse sobre las elecciones)*
```{r}
pander(cis_2020_df %>% dplyr::count(P10_2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10_2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P10_2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
No se reagrupa.

#### Variable `P10_3`: *Tercer lugar (Fuentes utilizadas para informarse sobre las elecciones)*
```{r}
pander(cis_2020_df %>% dplyr::count(P10_3, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10_3'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P10_3)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
No se reagrupa.


#### Variable `P10A`: *Periódico en formato impreso preferido para seguir la información política y electoral durante la campaña electoral*
```{r}
pander(cis_2020_df %>% dplyr::count(P10A, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10A'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P10A)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En primer lugar se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10A' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$P10A)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$P10A)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$P10A_GRUPO <- car::recode(var = cis_2020_df$P10A, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P10A)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P10A_GRUPO, .drop=FALSE))
```

Se hacen varias reagrupaciones[^P10AJRB],

[^P10AJRB]: Se siguen los criterios de JRB para la pregunta `P10A`.

```{r}
# cat(paste0("'", levels(cis_2020_df$P10A_GRUPO), "'", collapse = ", "), sep = "")

# Create recodes parameter
recodes_str <- "c('El Mundo', 'ABC', 'El Correo', 'El Diario Vasco') = 'Editoriales centro-derecha';
c('El País', 'Noticias de Guipúzcoa', 'Deia', 'Diario de Noticias (Álava, Navarra)', 'Cualquiera') = 'Editoriales centro-izquierda';
c('Berria', 'Gara', 'Otro') = 'Editoriales izquierda'"

# Recode
cis_2020_df$P10A_GRUPO <- car::recode(var = cis_2020_df$P10A_GRUPO, 
                                    recodes = recodes_str,
                                    levels = c('Editoriales centro-derecha', 'Editoriales centro-izquierda', 'Editoriales izquierda', 'N.C.'))
pander(cis_2020_df %>% dplyr::count(P10A_GRUPO, .drop=FALSE))
```


Se excluye la variable `P10A` y se deja la nueva agrupación `P10A_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P10A")
```


#### Variable `P10B`: *Periódico en formato digital preferido para seguir la información política y electoral durante la campaña electoral*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P10B, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10B'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P10B)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En primer lugar se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10B' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$P10B)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$P10B)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$P10B_GRUPO <- car::recode(var = cis_2020_df$P10B, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P10B)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P10B_GRUPO, .drop=FALSE))
```

Se hacen varias reagrupaciones[^P10BJRB],

[^P10BJRB]: Se siguen los criterios de JRB para la pregunta `P10B`.

```{r}
# cat(paste0("'", levels(cis_2020_df$P10B_GRUPO), "'", collapse = ", "), sep = "")

# Create recodes parameter
recodes_str <- "c('El Mundo', 'ABC', 'La Razón', 'OK Diario.es', 'El Correo', 'El Diario Vasco', 'El Independiente.com') = 'Editoriales centro-derecha';
c('El País', 'La Vanguardia', 'El Periódico de Catalunya', 'Noticias de Guipúzcoa', 'Deia', 'Diario de Noticias (Álava, Navarra)', '20 Minutos', 'El Confidencial.com') = 'Editoriales centro-izquierda';
c('Público.es', 'Eldiario.es', 'Berria', 'Gara', 'Infolibre.es', 'Otro') = 'Editoriales izquierda';
c('Periódicos digitales', 'Cualquiera') = 'Sin referencias'"

# Recode
cis_2020_df$P10B_GRUPO <- car::recode(var = cis_2020_df$P10B_GRUPO, 
                                    recodes = recodes_str,
                                    levels = c('Editoriales centro-derecha', 'Editoriales centro-izquierda', 'Editoriales izquierda', 'Sin referencias', 'N.C.'))
pander(cis_2020_df %>% dplyr::count(P10B_GRUPO, .drop=FALSE))
```


Se excluye la variable `P10B` y se deja la nueva agrupación `P10B_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P10B")
```


#### Variable `P10C`: *Cadena de televisión preferida para seguir la información política y electoral durante la campaña electoral*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P10C, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10C'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P10C)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En primer lugar se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10C' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$P10C)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$P10C)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$P10C_GRUPO <- car::recode(var = cis_2020_df$P10C, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P10C)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P10C_GRUPO, .drop=FALSE))
```

Se hacen varias reagrupaciones[^P10CJRB],

[^P10CJRB]: Se siguen los criterios de JRB para la pregunta `P10C`.

```{r}
# cat(paste0("'", levels(cis_2020_df$P10C_GRUPO), "'", collapse = ", "), sep = "")

# Create recodes parameter
recodes_str <- "c('TVE1', 'La 2', 'Canal 24 horas') = 'TV estatales públicas';
c('Antena 3', '13TV', 'Intereconomia TV') = 'A3Media+Derecha';
c('La Sexta') = 'A3Media+Izquierda';
c('La Cuatro', 'Telecinco') = 'Mediaset';
c('ETB1', 'ETB2', 'ETB') = 'TV vascas públicas';
c('Televisiones locales', 'Cualquiera sin especificar', 'Otra') ='Sin referencias claras'"

# Recode
cis_2020_df$P10C_GRUPO <- car::recode(var = cis_2020_df$P10C_GRUPO, 
                                    recodes = recodes_str,
                                    levels = c('TV estatales públicas', 'A3Media+Derecha', 'A3Media+Izquierda', 'Mediaset', 'TV vascas públicas', 'Sin referencias claras'))
pander(cis_2020_df %>% dplyr::count(P10C_GRUPO, .drop=FALSE))
```


Se excluye la variable `P10C` y se deja la nueva agrupación `P10C_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P10C")
```


#### Variable `P10D`: *Emisora de radio preferida para seguir la información política y electoral durante la campaña electoral*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P10D, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10D'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P10D)[aux_idx], "`", collapse = ", "), sep = "", ".")
```


En primer lugar se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P10D' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$P10D)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$P10D)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$P10D_GRUPO <- car::recode(var = cis_2020_df$P10D, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P10D)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P10D_GRUPO, .drop=FALSE))
```

Se hacen varias reagrupaciones[^P10DJRB],

[^P10DJRB]: Se siguen los criterios de JRB para la pregunta `P10D`.

```{r}
# cat(paste0("'", levels(cis_2020_df$P10D_GRUPO), "'", collapse = ", "), sep = "")

# Create recodes parameter
recodes_str <- "c('RNE (Sin especificar)', 'RNE-RADIO 5-Todo Noticias') = 'Estatales públicas';
c('Cadena COPE', 'Onda Cero', 'Es Radio') = 'Estatales centro-derecha';
c('Cadena Ser') = 'Estatales centro-izquierda';
c('Radio Euskadi, Euskadi Irratia', 'Onda Vasca') = 'Autonomistas';
c('Radio Euskadi Gaztea', 'Otras radios musicales', 'Cualquiera sin especificar', 'Radio 7', 'Radios autonómicas o locales', 'Otra') = 'Sin referencias claras';
c('N.S.', 'N.C.') = 'NS NC';
"

# Recode
cis_2020_df$P10D_GRUPO <- car::recode(var = cis_2020_df$P10D_GRUPO, 
                                    recodes = recodes_str,
                                    levels = c('Estatales públicas', 'Estatales centro-derecha', 'Estatales centro-izquierda', 'Autonomistas', 'Sin referencias claras', 'NS NC'))
pander(cis_2020_df %>% dplyr::count(P10D_GRUPO, .drop=FALSE))
```


Se excluye la variable `P10D` y se deja la nueva agrupación `P10D_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P10D")
```

### Variable `P11`: *Redes sociales en Internet en las que se tiene cuenta*

#### Variable `P11_9`: *Redes sociales en Internet en las que se tiene cuenta. Respuesta `N.C.`*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P11_9, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P11_9'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P11_9)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
 O sea que *No Contesta* ese número de veces.
 
 No se puede agrupar nada.


### Variable `P12`: *Tipos de páginas de Internet desde las que se ha seguido la información de las elecciones*

#### Variable `P12_9`: *Tipos de páginas de Internet desde las que se ha seguido la información de las elecciones. Respuesta `N.C.`*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P12_9, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P12_9'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P12_9)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
 O sea que *No Contesta* ese número de veces.
 
 No se puede agrupar nada.


### Variable `P13`: *Formas de seguimiento de la campaña electoral*

#### Preguntas `P13_1`, `P13_2` y `P13_3`.
 + `P13_1`: *Vio por televisión o escuchó por la radio algún debate o entrevistas con candidatos/as*
 + `P13_2`: *Vio o escuchó algún espacio de propaganda electoral de algún partido o coalición política*
 + `P13_3`: *Leyó o echó un vistazo a cartas, folletos o programas de algún partido o coalición política*

Estas preguntas tienen efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P13_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P13_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
 No se puede agrupar nada.
 
#### Pregunta `P13_4`: *Trabajó como voluntario/a en la campaña de algún partido o candidato/a*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P13_4, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P13_4'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P13_4)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

 No se puede agrupar nada.

#### Variable `P13_5`: *Asistió a un mitin o reunión de algún partido*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P13_5, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P13_5'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P13_5)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

 No se puede agrupar nada.

### Variable `P14`: *Contacto de algún partido político para pedir el voto*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P14, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P14'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P14)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

 No se puede agrupar nada.

#### Variable `P14A_95`: *Otro*

```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P14A_95, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P14A_95'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P14A_95)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

O sea que ha mencionado que contactó `Otro` partido diferente a los de la lista.

No se puede agrupar nada.


#### Variable `P14A_98`: *No recuerda*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P14A_98, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P14A_98'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P14A_98)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

O sea que `No recuerda` que partido de la lista le contactó.

No se puede agrupar nada.


#### Variable `P14A_99`: *N.C.*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P14A_99, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P14A_99'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P14A_99)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

O sea que `N.C.` (no contesta) quién le contactó.

No se puede agrupar nada.



### Variable `P15`: *Envío personal de mensajes electrónicos en relación con algún partido político*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P15, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P15'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P15)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

No se puede agrupar nada.


#### Variable `P15A_2`: *PSE-EE-PSOE*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P15A_2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P15A_2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P15A_2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

O sea que han enviado mensajes del `PSE-EE-PSOE`.

No se puede agrupar nada.

#### Variable `P15A_95`: *Otro*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P15A_95, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P15A_95'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P15A_95)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

O sea que han enviado mensajes de `Otro`.

No se puede agrupar nada.

#### Variable `P15A_99`: *N.C.*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P15A_99, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P15A_99'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P15A_99)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

O sea que dicen que `N.C.`.

No se puede agrupar nada.


### Variable `P16`: *Recepción de mensajes electrónicos en relación con algún partido político en las elecciones*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P16, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P16'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P16)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Sus respuestas son: `N.C.`.

No se puede agrupar nada.

#### Variable `P16A_95`: *Otro*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P16A_95, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P16A_95'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P16A_95)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Sus respuestas son: `Otro`.

No se puede agrupar nada.

#### Variable `P16A_99`: *N.C.*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P16A_99, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P16A_99'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P16A_99)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Sus respuestas son: `N.C.`.

No se puede agrupar nada.

### Variable `P17`: *Frecuencia con la que se ha hablado en diferentes entornos sociales de las elecciones*
#### Variable `P17_1`: *En casa, con su familia*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P17_1, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P17_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P17_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Sus respuestas son: `N.C.`.

No se puede agrupar nada.

#### Variable `P17_2`: *Con sus amigos/as*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P17_2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P17_2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P17_2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Sus respuestas son: `N.C.`.

No se puede agrupar nada.


#### Variable `P17_3`: *En su lugar de trabajo o centro de estudios*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P17_3, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P17_3'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P17_3)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Sus respuestas son: `N.C.`.

No se puede agrupar nada.

### Variable `P18`: *Conocimiento de los resultados de sondeos electorales durante la campaña electoral*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P18, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en la modalidad 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P18'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P18)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Sus respuestas son: `N.C.`.

No se puede agrupar nada.

#### Variable `P18A`: *Grado de influencia personal de los sondeos de las elecciones*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P18A, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades: 
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P18A'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P18A)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se realizan dos reagrupaciones:
 + `Mucho` + `Bastante` $\Rightarrow$ `Bastante+`
 +  `N.S.` + `N.C.` $\Rightarrow$ `NS_NC`

```{r}
# Create recodes parameter
recodes_str <- "c('Mucho', 'Bastante') = 'Bastante+'; c('N.S.', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P18A) %in% c('Mucho', 'Bastante', 'N.S.', 'N.C.'))
# Recode
cis_2020_df$P18A_GRUPO <- car::recode(var = cis_2020_df$P18A, 
                                    recodes = recodes_str,
                                    levels = c('Bastante+', levels(cis_2020_df$P18A)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P18A_GRUPO, .drop=FALSE))
```

Se excluye la variable `P18A` y se deja la nueva agrupación `P18A_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P18A")
```

#### Variable `P18B`: *Sentido en que le influyeron los resultados de los sondeos*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P18B, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P18B'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P18B)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan las modalidades `N.S.` y `N.C.` en una sola.
```{r}
# Create recodes parameter
recodes_str <- "c('N.S.', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P18B) %in% c('N.S.', 'N.C.'))
# Recode
cis_2020_df$P18B_GRUPO <- car::recode(var = cis_2020_df$P18B, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P18B)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P18B_GRUPO, .drop=FALSE))
```

Se excluye la variable `P18B` y se deja la nueva agrupación `P18B_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P18B")
```

**En este caso no tengo criterio para hacer agrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `P19`: *Decisión respecto al voto en las elecciones*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P19, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P19'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P19)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se hace ninguna reagrupación.

#### Variable `P19A01`: *Partidos políticos entre los que se duda el voto (2)*

```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P19A01, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P19A01'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P19A01)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer agrupaciones. Quedo pendiente de la respuesta que me de JRB.**


#### Variable `P19A02`: *Partidos políticos entre los que se duda el voto (2)*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P19A02, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P19A02'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P19A02)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer agrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `P20`: *Recuerdo de voto en las elecciones*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P20, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P20'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P20)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer agrupaciones. Quedo pendiente de la respuesta que me de JRB.**


#### Variable `P20A_1`: *Primer lugar*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P20A_1, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P20A_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P20A_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan las modalidades `N.S.` y `N.C.` en una sola.
```{r}
# Create recodes parameter
recodes_str <- "c('N.S.', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P20A_1) %in% c('N.S.', 'N.C.'))
# Recode
cis_2020_df$P20A_1_GRUPO <- car::recode(var = cis_2020_df$P20A_1, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P20A_1)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P20A_1_GRUPO, .drop=FALSE))
```

Se excluye la variable `P20A_1` y se deja la nueva agrupación `P20A_1_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P20A_1")
```


### Variable `P21`: *Participación electoral en las elecciones*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P21, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P21'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P21)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.

**Este caso queda a criterio de JRB.**

#### Variable `P21A`: *Momento de la decisión de no vota*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P21A, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P21A'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P21A)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.


#### Variable `P21B_1`: *Primer lugar*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P21B_1, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P21B_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P21B_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan las modalidades `N.S.` y `N.C.` en una sola.
```{r}
# Create recodes parameter
recodes_str <- "c('N.S.', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P21B_1) %in% c('N.S.', 'N.C.'))
# Recode
cis_2020_df$P21B_1_GRUPO <- car::recode(var = cis_2020_df$P21B_1, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P21B_1)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P21B_1_GRUPO, .drop=FALSE))
```

Se excluye la variable `P21B_1` y se deja la nueva agrupación `P21B_1_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P21B_1")
```

#### Variable `P21B_2`: *Segundo lugar*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P21B_2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P21B_2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P21B_2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**

#### Variable `P21C`: *Razones que impidieron votar*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P21C, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P21C'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P21C)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En primer lugar se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P21C' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$P21C)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$P21C)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$P21C_GRUPO <- car::recode(var = cis_2020_df$P21C, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P21C)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P21C_GRUPO, .drop=FALSE))
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**

Se excluye la variable `P21C` y se deja la nueva agrupación `P21C_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P21C")
```


### Variable `P22`: *Momento de la decisión de voto en las elecciones*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P22, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P22'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P22)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `P23`: *Decisión respecto al voto en las elecciones de haber conocido antes los resultados*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P23, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P23'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P23)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `P24`: *Escala de probabilidad (0-10) de votar a diferentes partidos políticos*

#### Variable `P24_5`: *PP*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P24_5, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P24_5'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P24_5)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan por un lado `6`+`7` y por otro `8`+`9`+`10`.

```{r}
# levels(cis_2020_df$P24_5)[3]

# Create recodes parameter
recodes_str <- "c('6', '7') = '6_7'; c('8', '9', '10 Con toda seguridad, lo votaría siempre') = '8_10'"
# Recode
cis_2020_df$P24_5_GRUPO <- car::recode(var = cis_2020_df$P24_5, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P24_5)[c(1,2,4,5,6,7)], "6_7", "8_10", levels(cis_2020_df$P24_5)[c(12,13)]))
pander(cis_2020_df %>% dplyr::count(P24_5_GRUPO, .drop=FALSE))
```

Se excluye la variable `P24_5` y se deja la nueva agrupación `P24_5_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P24_5")
```

#### Variable `P24_6`: *Ciudadanos*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P24_6, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P24_6'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P24_6)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan por un lado `6`+`7` y por otro `8`+`9`+`10`.


```{r}
# levels(cis_2020_df$P24_6)[3]

# Create recodes parameter
recodes_str <- "c('6', '7') = '6_7'; c('8', '9', '10 Con toda seguridad, lo votaría siempre') = '8_9_10'"
# Recode
cis_2020_df$P24_6_GRUPO <- car::recode(var = cis_2020_df$P24_6, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P24_6)[c(1,2,4,5,6,7)], "6_7", "8_9_10", levels(cis_2020_df$P24_6)[c(12,13)]))
pander(cis_2020_df %>% dplyr::count(P24_6_GRUPO, .drop=FALSE))
```

Se excluye la variable `P24_6` y se deja la nueva agrupación `P24_6_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P24_6")
```


#### Variable `P24_7`: *VOX*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P24_7, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P24_7'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P24_7)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan por un lado `2`+`3`+`4`, por otro `5`+`6` y por otro `7`+`8`+`9`+`10`.


```{r}
# levels(cis_2020_df$P24_7)[3]

# Create recodes parameter
recodes_str <- "c('2', '3', '4') = '2_3_4'; c('5', '6') = '5_6'; c('7', '8', '9', '10 Con toda seguridad, lo votaría siempre') = '7_10'"
# Recode
cis_2020_df$P24_7_GRUPO <- car::recode(var = cis_2020_df$P24_7, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P24_7)[c(1,2)], "2_3_4", "5_6", "7_10", levels(cis_2020_df$P24_7)[c(12,13)]))
pander(cis_2020_df %>% dplyr::count(P24_7_GRUPO, .drop=FALSE))
```

Se excluye la variable `P24_7` y se deja la nueva agrupación `P24_7_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P24_7")
```


### Variable `PARTICIPACIONA`: *Participación electoral en las elecciones autonómicas de 2016*

```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(PARTICIPACIONA, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'PARTICIPACIONA'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$PARTICIPACIONA)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


#### Variable `RECUVOTOA`: *Recuerdo de voto en las elecciones autonómicas de 2016 de los votantes*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(RECUVOTOA, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'RECUVOTOA'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$RECUVOTOA)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `P26`: *Conocimiento y escala de valoración (1-10) de líderes políticos*

#### Variable `P26_1`: *Íñigo Urkullu*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P26_1, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P26_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P26_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se realiza ninguna reagrupación.

#### Variable `P26_2`: *Maddalen Iriarte*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P26_2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P26_2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P26_2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se realiza ninguna reagrupación.

#### Variable `P26_3`: *Idoia Mendia*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P26_3, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P26_3'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P26_3)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P26_3)[aux_idx], collapse = "', '"), "') = '9_10'")
cis_2020_df$P26_3_GRUPO <- car::recode(var = cis_2020_df$P26_3, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P26_3)[c(1,3:9)], '9_10', levels(cis_2020_df$P26_3)[11:13]))
pander(cis_2020_df %>% dplyr::count(P26_3_GRUPO), .drop=FALSE)
```

Se excluye la variable `P26_3` y se deja la nueva agrupación `P26_3_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P26_3")
```


#### Variable `P26_4`: *Miren Gorrotxategi*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P26_4, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P26_4'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P26_4)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P26_4)[aux_idx], collapse = "', '"), "') = '9_10'")
cis_2020_df$P26_4_GRUPO <- car::recode(var = cis_2020_df$P26_4, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P26_4)[c(1,3:9)], '9_10', levels(cis_2020_df$P26_4)[11:13]))
pander(cis_2020_df %>% dplyr::count(P26_4_GRUPO), .drop=FALSE)
```

Se excluye la variable `P26_4` y se deja la nueva agrupación `P26_4_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P26_4")
```


#### Variable `P26_5`: *Carlos Iturgaiz*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P26_5, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P26_5'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P26_5)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan todas ellas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P26_5)[aux_idx], collapse = "', '"), "') = '7_10'")
cis_2020_df$P26_5_GRUPO <- car::recode(var = cis_2020_df$P26_5, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P26_5)[c(1,3:7)], '7_10', levels(cis_2020_df$P26_5)[11:13]))
pander(cis_2020_df %>% dplyr::count(P26_5_GRUPO), .drop=FALSE)
```

Se excluye la variable `P26_5` y se deja la nueva agrupación `P26_5_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P26_5")
```

#### Variable `P26_6`: *Amaia Martínez*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P26_6, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P26_6'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P26_6)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan todas ellas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$P26_6)[aux_idx], collapse = "', '"), "') = '6_10'")
cis_2020_df$P26_6_GRUPO <- car::recode(var = cis_2020_df$P26_6, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$P26_6)[c(1,3:6)], '6_10', levels(cis_2020_df$P26_6)[11:13]))
pander(cis_2020_df %>% dplyr::count(P26_6_GRUPO), .drop=FALSE)
```

Se excluye la variable `P26_6` y se deja la nueva agrupación `P26_6_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P26_6")
```


### Variable `P28`: *Sentimiento nacionalista del País Vasco*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P28, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P28'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P28)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

```{r}
# Create recodes parameter
recodes_str <- "c('N.S.', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$P28) %in% c('N.S.', 'N.C.'))
# Recode
cis_2020_df$P28_GRUPO <- car::recode(var = cis_2020_df$P28, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P28)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(P28_GRUPO, .drop=FALSE))
```


Se excluye la variable `P28` y se deja la nueva agrupación `P28_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P28")
```

### Variable `PARTICIPACIONG`: *Participación electoral en las elecciones generales de noviembre de 2019*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(PARTICIPACIONG, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'PARTICIPACIONG'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$PARTICIPACIONG)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


#### Variable `RECUVOTOG`: *Recuerdo de voto en las elecciones generales de noviembre de 2019 de los votantes*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(RECUVOTOG, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'RECUVOTOG'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$RECUVOTOG)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `ESCIDEOL`: *Escala de autoubicación ideológica (1-10)*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOL, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOL'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOL)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$ESCIDEOL)[aux_idx], collapse = "', '"), "') = '9_10'")
cis_2020_df$ESCIDEOL_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOL, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$ESCIDEOL)[c(1,3:9)], '9_10', levels(cis_2020_df$ESCIDEOL)[11:12]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOL_GRUPO), .drop=FALSE)
```

Se excluye la variable `ESCIDEOL` y se deja la nueva agrupación `ESCIDEOL_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOL")
```

### Variable `P32`: *Escala de ubicación ideológica (1-10) de partidos políticos*

#### Variable `ESCIDEOLPAR_1`: *EAJ-PNV*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_1, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOLPAR_1'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOLPAR_1)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$ESCIDEOLPAR_1)[aux_idx], collapse = "', '"), "') = '1_2'")
cis_2020_df$ESCIDEOLPAR_1_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOLPAR_1, 
                                    recodes = recodes_str, 
                                    levels = c('1_2', levels(cis_2020_df$ESCIDEOLPAR_1)[c(4:10,2)], levels(cis_2020_df$ESCIDEOLPAR_1)[11:12]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_1_GRUPO), .drop=FALSE)
```

Se excluye la variable `ESCIDEOLPAR_1` y se deja la nueva agrupación `ESCIDEOLPAR_1_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOLPAR_1")
```

#### Variable `ESCIDEOLPAR_2`: *EH Bildu*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOLPAR_2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOLPAR_2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan por un lado `6`+`7` y por otro `8`+`9`+`10`.

```{r}
# levels(cis_2020_df$ESCIDEOLPAR_2)[3]

# Create recodes parameter
recodes_str <- "c('6', '7') = '6_7'; c('8', '9', '10 Derecha') = '8_10'"
# Recode
cis_2020_df$ESCIDEOLPAR_2_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOLPAR_2, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$ESCIDEOLPAR_2)[c(1,3:6)], "6_7", "8_10", levels(cis_2020_df$ESCIDEOLPAR_2)[c(11,12)]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_2_GRUPO, .drop=FALSE))
```

Se excluye la variable `ESCIDEOLPAR_2` y se deja la nueva agrupación `ESCIDEOLPAR_2_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOLPAR_2")
```

#### Variable `ESCIDEOLPAR_3`: *PSE-EE-PSOE*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_3, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOLPAR_3'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOLPAR_3)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan ambas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$ESCIDEOLPAR_3)[aux_idx], collapse = "', '"), "') = '9_10'")
cis_2020_df$ESCIDEOLPAR_3_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOLPAR_3, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$ESCIDEOLPAR_3)[c(1,3:9)], '9_10', levels(cis_2020_df$ESCIDEOLPAR_3)[11:12]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_3_GRUPO), .drop=FALSE)
```

Se excluye la variable `ESCIDEOLPAR_3` y se deja la nueva agrupación `ESCIDEOLPAR_3_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOLPAR_3")
```

#### Variable `ESCIDEOLPAR_4`: *Elkarrekin Podemos*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_4, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOLPAR_4'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOLPAR_4)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan todas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$ESCIDEOLPAR_4)[aux_idx], collapse = "', '"), "') = '7_10'")
cis_2020_df$ESCIDEOLPAR_4_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOLPAR_4, 
                                    recodes = recodes_str, 
                                    levels = c(levels(cis_2020_df$ESCIDEOLPAR_4)[c(1,3:7)], '7_10', levels(cis_2020_df$ESCIDEOLPAR_4)[11:12]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_4_GRUPO), .drop=FALSE)
```

Se excluye la variable `ESCIDEOLPAR_4` y se deja la nueva agrupación `ESCIDEOLPAR_4_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOLPAR_4")
```

#### Variable `ESCIDEOLPAR_5`: *PP*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_5, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOLPAR_5'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOLPAR_5)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan todas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$ESCIDEOLPAR_5)[aux_idx], collapse = "', '"), "') = '1_4'")
cis_2020_df$ESCIDEOLPAR_5_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOLPAR_5, 
                                    recodes = recodes_str, 
                                    levels = c('1_4', levels(cis_2020_df$ESCIDEOLPAR_5)[c(6:10,2)], levels(cis_2020_df$ESCIDEOLPAR_5)[11:12]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_5_GRUPO), .drop=FALSE)
```

Se excluye la variable `ESCIDEOLPAR_5` y se deja la nueva agrupación `ESCIDEOLPAR_5_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOLPAR_5")
```


#### Variable `ESCIDEOLPAR_6`: *Ciudadanos*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_6, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOLPAR_6'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOLPAR_6)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan todas en una sola.
```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$ESCIDEOLPAR_6)[aux_idx], collapse = "', '"), "') = '1_4'")
cis_2020_df$ESCIDEOLPAR_6_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOLPAR_6, 
                                    recodes = recodes_str, 
                                    levels = c('1_4', levels(cis_2020_df$ESCIDEOLPAR_6)[c(6:10,2)], levels(cis_2020_df$ESCIDEOLPAR_6)[11:12]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_6_GRUPO), .drop=FALSE)
```

Se excluye la variable `ESCIDEOLPAR_6` y se deja la nueva agrupación `ESCIDEOLPAR_6_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOLPAR_6")
```

#### Variable `ESCIDEOLPAR_7`: *VOX*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_7, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCIDEOLPAR_7'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCIDEOLPAR_7)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan por un lado `2`+`3`+`4`+`5` y por otro `6`+`7`:

```{r}
# Create recodes parameter
recodes_str <- "c('2', '3', '4', '5') = '2_5'; c('6', '7') = '6_7'"
# Recode
cis_2020_df$ESCIDEOLPAR_7_GRUPO <- car::recode(var = cis_2020_df$ESCIDEOLPAR_7, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$ESCIDEOLPAR_7)[1], "2_5", "6_7", levels(cis_2020_df$ESCIDEOLPAR_7)[c(9,10,2,11,12)]))
pander(cis_2020_df %>% dplyr::count(ESCIDEOLPAR_7_GRUPO, .drop=FALSE))
```

Se excluye la variable `ESCIDEOLPAR_7` y se deja la nueva agrupación `ESCIDEOLPAR_7_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCIDEOLPAR_7")
```


### Variable *P33*, `ESCUELA`: *Escolarización de la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESCUELA, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESCUELA'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESCUELA)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan dos de ellas en una sola:

```{r}
# Create recodes parameter
recodes_str <- paste0("c('", paste0(levels(cis_2020_df$ESCUELA)[aux_idx[c(1,2)]], collapse = "', '"), "') = 'No, pero sabe leer y escribir-'")
cis_2020_df$ESCUELA_GRUPO <- car::recode(var = cis_2020_df$ESCUELA, 
                                    recodes = recodes_str, 
                                    levels = c('No, pero sabe leer y escribir-', levels(cis_2020_df$ESCUELA)[c(3,4)]))
pander(cis_2020_df %>% dplyr::count(ESCUELA_GRUPO), .drop=FALSE)
```

Se excluye la variable `ESCUELA` y se deja la nueva agrupación `ESCUELA_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "ESCUELA")
```

#### Variable *P33A*, `NIVELESTENTREV`: *Nivel de estudios alcanzado por la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(NIVELESTENTREV, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'NIVELESTENTREV'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$NIVELESTENTREV)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se reagrupan `Otros estudios`+`N.S./No recuerda`+`N.C.` en una sola:

```{r}
# Create recodes parameter
recodes_str <- "c('Otros estudios ', 'N.S./No recuerda ', 'N.C.') = 'NS_NC'"
# select old levels indices
aux_idx <- which(levels(cis_2020_df$NIVELESTENTREV) %in% c('Otros estudios ', 'N.S./No recuerda ', 'N.C.'))
# Recode
cis_2020_df$NIVELESTENTREV_GRUPO <- car::recode(var = cis_2020_df$NIVELESTENTREV, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$NIVELESTENTREV)[-aux_idx], 'NS_NC'))
pander(cis_2020_df %>% dplyr::count(NIVELESTENTREV_GRUPO, .drop=FALSE))
```

Se excluye la variable `NIVELESTENTREV` y se deja la nueva agrupación `NIVELESTENTREV_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "NIVELESTENTREV")
```

### Variable *P34*, `RELIGION`: *Religiosidad de la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(RELIGION, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'RELIGION'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$RELIGION)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.

#### Variable *P34A*, `FRECUENCIARELI`: *Frecuencia de asistencia a oficios religiosos*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(FRECUENCIARELI, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'FRECUENCIARELI'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$FRECUENCIARELI)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.


### Variable *P35*, `ESTADOCIVIL`: *Estado civil de la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESTADOCIVIL, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESTADOCIVIL'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESTADOCIVIL)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.


### Variable `SITLAB`: *Situación laboral de la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(SITLAB, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'SITLAB'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$SITLAB)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `CNO11`: *Ocupación de la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(CNO11, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'CNO11'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$CNO11)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.


### Variable `RELALAB`: *Situación profesional de la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(RELALAB, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'RELALAB'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$RELALAB)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `CLASESOCIAL`: *Clase social subjetiva de la persona entrevistada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(CLASESOCIAL, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'CLASESOCIAL'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$CLASESOCIAL)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

Se hacen varias reagrupaciones:

```{r}
# Create recodes parameter
recodes_str <- "c('Clase alta ', 'Clase media-alta ') = 'Clase media-alta+'; c('Clase pobre ', 'Infraclase', 'Proletariado', 'A los/as de abajo ', 'Excluidos/as', 'A la gente común ') = 'Clase pobre-'; c('Otras', 'No cree en las clases ') = 'Otras+'"
# Recode
cis_2020_df$CLASESOCIAL_GRUPO <- car::recode(var = cis_2020_df$CLASESOCIAL, 
                                    recodes = recodes_str,
                                    levels = c("Clase media-alta+", levels(cis_2020_df$CLASESOCIAL)[c(3:5)], "Clase pobre-", levels(cis_2020_df$CLASESOCIAL)[12], "Otras+", levels(cis_2020_df$CLASESOCIAL)[c(15,16)]))
pander(cis_2020_df %>% dplyr::count(CLASESOCIAL_GRUPO, .drop=FALSE))
```

Se excluye la variable `CLASESOCIAL` y se deja la nueva agrupación `CLASESOCIAL_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "CLASESOCIAL")
```

### Variables `IA_I501` - `IA_I537`

Desconozco el significado de las modalidades que tienen la variables que van desde `IA_I501` hasta `IA_I537`. Por tanto las excluyo hasta que tenga un mejor conocimiento de ellas.

```{r}
# list of variables
excluded_cols <- c(excluded_cols, colnames(cis_2020_df)[startsWith(colnames(cis_2020_df), 'IA_I5')])
```

**Dejo a criterio de JRB si incluir estas variables o no y cómo hacerlo**

### Variable `IA_E1_DIA`: *Fecha de realización (día)*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_E1_DIA, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_E1_DIA'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_E1_DIA)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
Se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_E1_DIA' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$IA_E1_DIA)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$IA_E1_DIA)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$IA_E1_DIA_GRUPO <- car::recode(var = cis_2020_df$IA_E1_DIA, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$IA_E1_DIA)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(IA_E1_DIA_GRUPO, .drop=FALSE))
```


Se excluye la variable `IA_E1_DIA` y se deja la nueva agrupación `IA_E1_DIA_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "IA_E1_DIA")
```


### Variable `IA_E2`: *Día de la semana que se realiza la entrevista*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_E2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_E2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_E2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
Se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_E2' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$IA_E2)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$IA_E2)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$IA_E2_GRUPO <- car::recode(var = cis_2020_df$IA_E2, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$IA_E2)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(IA_E2_GRUPO, .drop=FALSE))
```


Se excluye la variable `IA_E2` y se deja la nueva agrupación `IA_E2_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "IA_E2")
```


### Variable `IA_E4`: *Hora de realización*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_E4, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_E4'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_E4)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
Se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_E4' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$IA_E4)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$IA_E4)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$IA_E4_GRUPO <- car::recode(var = cis_2020_df$IA_E4, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$IA_E4)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(IA_E4_GRUPO, .drop=FALSE))
```


Se excluye la variable `IA_E4` y se deja la nueva agrupación `IA_E4_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "IA_E4")
```

### Variable `IA_MODIFICADA`: *Entrevista modificada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_MODIFICADA, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_MODIFICADA'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_MODIFICADA)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
No se reagrupa esa modalidad.


### Variable `IA_SUPERVISADA`: *Entrevista supervisada*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_SUPERVISADA, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_SUPERVISADA'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_SUPERVISADA)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
No se reagrupa esa modalidad.


### Variable `IA_C2`: *Valoración de la supervisión*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_C2, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_C2'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_C2)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
Se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_C2' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$IA_C2)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$IA_C2)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$IA_C2_GRUPO <- car::recode(var = cis_2020_df$IA_C2, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$IA_C2)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(IA_C2_GRUPO, .drop=FALSE))
```

Se excluye la variable `IA_C2` y se deja la nueva agrupación `IA_C2_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "IA_C2")
```

#### Variable `IA_C2A`: *Resultado supervisión*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_C2A, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_C2A'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_C2A)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
Se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_C2A' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$IA_C2A)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$IA_C2A)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$IA_C2A_GRUPO <- car::recode(var = cis_2020_df$IA_C2A, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$IA_C2A)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(IA_C2A_GRUPO, .drop=FALSE))
```


Esta variable no aporta información con la que discriminar entrevistas porque todos sus elementos tienen el mismo valor. Por tanto se excluyen del análisis ACM.
```{r}
excluded_cols <- c(excluded_cols, "IA_C2A", "IA_C2A_GRUPO")
```


### Variable `IA_C3`: *Resultado final*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(IA_C3, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_C3'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$IA_C3)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
Se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'IA_C3' & efectivo_peq_df$freq == 0),"modalidad"])
# # Write factors
# cat(paste0("`", levels(cis_2020_df$IA_C3)[aux_idx], "`", collapse = ", "), sep = "", ".")

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", levels(cis_2020_df$IA_C3)[aux_idx], "'", collapse = ", "))

# Recode
cis_2020_df$IA_C3_GRUPO <- car::recode(var = cis_2020_df$IA_C3, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$IA_C3)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(IA_C3_GRUPO, .drop=FALSE))
```

Esta variable no aporta información con la que discriminar entrevistas porque todos sus elementos tienen el mismo valor. Por tanto se excluyen del análisis ACM.
```{r}
excluded_cols <- c(excluded_cols, "IA_C3", "IA_C3_GRUPO")
```


### Variable `P19ACOM`: *Partidos políticos entre los que se duda el voto en las elecciones (2)[recodificada]*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(P19ACOM, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P19ACOM'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$P19ACOM)[aux_idx], "`", collapse = ", "), sep = "", ".")
```
Se eliminan las modalidades con cero efectivos.

```{r}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'P19ACOM' & efectivo_peq_df$freq == 0),"modalidad"])
# Replace ' character with escape character \\'
str_aux_1 <- levels(cis_2020_df$P19ACOM)[aux_idx]
str_aux_2 <- gsub(pattern = "'", replacement = "\\\\'", x = str_aux_1)

# Create recodes parameter
recodes_str <- sprintf("c(%s) = NA",
                       paste0("'", str_aux_2, "'", collapse = ", "))

# Recode
cis_2020_df$P19ACOM_GRUPO <- car::recode(var = cis_2020_df$P19ACOM, 
                                    recodes = recodes_str,
                                    levels = c(levels(cis_2020_df$P19ACOM)[-aux_idx]))
pander(cis_2020_df %>% dplyr::count(P19ACOM_GRUPO, .drop=FALSE))
```


Se excluye la variable `P19ACOM` y se deja la nueva agrupación `P19ACOM_GRUPO`.
```{r}
excluded_cols <- c(excluded_cols, "P19ACOM")
```


**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**



### Variable `RVAUTO20`: *Recuerdo de voto en las elecciones autonómicas del País Vasco de 2020*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(RVAUTO20, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'RVAUTO20'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$RVAUTO20)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**



### Variable `RVAUTO16`: *Recuerdo de voto en las elecciones autonómicas del País Vasco de 2016 [recodificada]*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(RVAUTO16, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'RVAUTO16'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$RVAUTO16)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `RECUERDO`: *Recuerdo de voto en las elecciones generales de noviembre de 2019 [recodificada]*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(RECUERDO, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'RECUERDO'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$RECUERDO)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**




### Variable `ESTUDIOS`: *Estudios de la persona entrevistada [recodificada]*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(ESTUDIOS, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'ESTUDIOS'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$ESTUDIOS)[aux_idx], "`", collapse = ", "), sep = "", ".")
```


**En este caso no tengo criterio para hacer reagrupaciones. Quedo pendiente de la respuesta que me de JRB.**


### Variable `CLASESUB`: *Identificación subjetiva de clase [recodificada]*
```{r}
require(pander)
pander(cis_2020_df %>% dplyr::count(CLASESUB, .drop=FALSE))
```

Esta pregunta tiene efectivos pequeños en las modalidades:  
```{r echo=FALSE, results='asis'}
# Select factor numbers from efectivo_peq_df
aux_idx <- as.numeric(efectivo_peq_df[which(efectivo_peq_df$variable == 'CLASESUB'),"modalidad"])
# Write factors
cat(paste0("`", levels(cis_2020_df$CLASESUB)[aux_idx], "`", collapse = ", "), sep = "", ".")
```

En este caso no se reagrupa nada.



## Resumen estadístico. Datos cualitativos.
```{r}
# Cleaning
excluded_cols <- unique(excluded_cols)
# Declare included cols
included_cols_idx <- which(!(colnames(cis_2020_df) %in% excluded_cols))
included_cols <- colnames(cis_2020_df)[included_cols_idx]
```


O sea que finalmente se va a realizar un ACM con $Q =$ 
```{r echo=FALSE, results='asis'}
Q <- length(cis_2020_df) - length(excluded_cols)
cat(Q)
```
 preguntas.




```{r}
### (cis_2020_summ <- summary(cis_2020_df))
```



```{r save_variables}
# Save data variables to cis_2020_cuisine_file.RData
# cis_2020_cuisine_file <- file.path(getwd(), "data", "cis_2020_cuisine_file.RData")
cis_2020_cuisine_file <- file.path(getwd(), "cis_2020_cuisine_file.RData")

require(log4r)
log4r::debug(logger, paste("cis_2020_cuisine_file (", cis_2020_cuisine_file, ") exists =", file.exists(cis_2020_cuisine_file)))

# Save every data in an RData file.
# It will be used later in the Rmd file.
save(list = ls(), file=cis_2020_cuisine_file)
log4r::debug(logger, paste("Saved cis_2020_cuisine_file dataset"))
```



***

\pagebreak


---
